# Скрипт Визуализации Распределения IP Адресов

## Обзор

**Скрипт Визуализации Распределения IP Адресов** генерирует визуальное представление сетки распределения IP адресов на основе входных CSV файлов, содержащих префиксы сети и детали IP адресов. Выходной файл представляет собой изображение в формате PNG, отображающее распределенные IP адреса, закодированные цветом по арендаторам, ролям, статусам и тегам, а также сеточные линии и области префиксов.

## Особенности

- **Визуализация Сетки**: Отображает распределение IP адресов на настраиваемой сетке с использованием Z-порядка (Morton) кривой.
- **Кодирование Цветом**: Различает IP адреса на основе назначений арендаторов, ролей, статусов и тегов.
- **Представление Префиксов**: Выделяет подпрефиксы внутри верхнего сетевого префикса.
- **Гибкая Конфигурация**: Поддерживает квадратные и прямоугольные размеры сетки с регулируемым размером ячеек.
- **Логирование**: Предоставляет подробные логи для мониторинга и устранения неполадок.

## Установка

### Предварительные Требования

- **Python 3.6+**
- **Необходимые Библиотеки Python**:
  - `csv`
  - `ipaddress`
  - `math`
  - `matplotlib`
  - `numpy`
  - `logging`
  - `argparse`

### Шаги Установки

1. **Клонируйте Репозиторий**:

    ```bash
    git clone https://github.com/islepnev/ip-allocation-visualization.git
    cd ip-allocation-visualization
    ```

2. **Установите Зависимости**:
    Убедитесь, что у вас установлен `pip`. Затем установите необходимые библиотеки:

    ```bash
    pip install matplotlib numpy
    ```

## Использование

### Аргументы Командной Строки

- `-p`, `--prefixes`: Путь к CSV файлу префиксов.
  - **По Умолчанию**: `prefixes.csv`
- `-i`, `--ip_addresses`: Путь к CSV файлу IP адресов.
  - **По Умолчанию**: `ip_addresses.csv`
- `-o`, `--output`: Имя выходного PNG файла.
  - **По Умолчанию**: `allocation_grid.png`
- `-c`, `--cell_size`: Размер каждой ячейки сетки в пикселях.
  - **По Умолчанию**: `4`

### Запуск Скрипта

```bash
python ip_allocation_visualization.py -p path/to/prefixes.csv -i path/to/ip_addresses.csv -o output_image.png -c 5
```

### Пример

```bash
python ip_allocation_visualization.py
```

Эта команда использует файлы по умолчанию и размер ячейки:

- CSV префиксов: `prefixes.csv`
- CSV IP адресов: `ip_addresses.csv`
- Выходной PNG: `allocation_grid.png`
- Размер ячейки: `4` пикселя

## Входные Файлы

### CSV Префиксов

- **Назначение**: Определение сетевых префиксов и связанных арендаторов.
- **Обязательные Поля**:
  - `Prefix`: Сетевой префикс (например, `192.168.0.0/16`)
  - `Tenant`: Название связанного арендатора
- **Дополнительные Поля**: Могут включать другие произвольные ключи.

### CSV IP Адресов

- **Назначение**: Определение распределения IP адресов и их атрибутов.
- **Обязательные Поля**:
  - `IP Address`: Индивидуальный IP адрес (игнорирует любую CIDR нотацию)
- **Необязательные Поля**:
  - `Tags`: Теги, связанные с IP
  - `Role`: Назначение роли (например, `Router`, `Switch`)
  - `Status`: Статус распределения (`Active`, `Reserved`, `Inactive`)
  - `Tenant`: Название связанного арендатора
- **Дополнительные Поля**: Могут включать другие произвольные ключи.

## Выходные Данные

- **Изображение Сетки Распределения**:
  - **Формат**: PNG
  - **Содержание**: Визуальная сетка, отображающая распределенные IP адреса, области префиксов и сеточные линии с цветовым кодированием на основе арендаторов, ролей, статусов и тегов.

## Конфигурация Сетки

### Размеры

- **Ширина (`GRID_WIDTH`)**: Целое число, степень двойки (например, 256)
- **Высота (`GRID_HEIGHT`)**: Целое число, степень двойки (например, 128)
- **Поддерживаемые Соотношения Сторон**:
  - 1:1 (Квадратная Сетка): `GRID_WIDTH` == `GRID_HEIGHT`
  - 2:1 (Прямоугольная Сетка): `GRID_WIDTH` == `2 * GRID_HEIGHT`

### Размер Ячейки

- **Параметр**: `cell_size` (пиксели)
- **По Умолчанию**: 4 пикселя
- **Характеристики**:
  - Ячейки квадратные.
  - Заполненная область: `cell_size - 1` пикселей для поддержания 1-пиксельного промежутка.

## Цветовое Кодирование

### Цветовое Кодирование Арендаторов

- **Метод**: Предварительно созданное соответствие от нормализованных названий арендаторов к цветовым кодам в формате HEX с использованием простой операции деления по модулю на основе предопределенной цветовой палитры.
- **Нормализация**: Названия арендаторов преобразуются в нижний регистр и очищаются от неалфавитно-цифровых символов.
- **Цвет по Умолчанию**: `'none'` для неизвестных арендаторов.

### Определение Цвета IP

- **Условия**:
  - Если `Role` или `Tags` не пусты: назначить специальный цвет (например, глубокий красный).
  - Если `Status` равен `Reserved`: назначить полупрозрачный черный (`alpha=0.25`).
  - Если `Status` равен `Inactive`: назначить прозрачный (`alpha=0`).
  - В противном случае: назначить цвет по умолчанию (например, черный).

## Логирование

- **Уровни**:
  - **INFO**: Общие операционные сообщения (например, количество загруженных записей, обновления прогресса).
  - **DEBUG**: Детальная диагностическая информация (например, неверные форматы IP, количество распределений).
- **Обработчики**:
  - **Консоль**: Отображает сообщения уровня INFO.
  - **Файл**: Логирует сообщения уровня DEBUG в файл `ip_allocation.log`.

## Технические Компоненты

- **Библиотеки**:
  - `csv`: Для чтения входных CSV файлов.
  - `ipaddress`: Для манипуляции IP адресами.
  - `math`: Для математических операций (например, log2).
  - `matplotlib`: Для генерации изображений.
  - `numpy`: Для эффективной обработки данных сетки.
  - `logging`: Для операций логирования.
  - `argparse`: Для парсинга аргументов командной строки.

## Ограничения и Предусловия

- **Размеры Сетки**:
  - `GRID_WIDTH` и `GRID_HEIGHT` должны быть целыми числами, являющимися степенями двойки.
  - Поддерживаемые Соотношения Сторон:
    - 1:1 (Квадратная Сетка)
    - 2:1 (Прямоугольная Сетка: `GRID_WIDTH` == `2 * GRID_HEIGHT`)
- **Целостность Данных**:
  - Записи IP должны содержать валидное поле `IP Address`.
  - Записи префиксов должны содержать валидное поле `Prefix` с длиной префикса `/16`.
- **Цветовая Палитра**:
  - Предопределенная палитра должна покрывать ожидаемое количество арендаторов, чтобы минимизировать повторение цветов.

## Расширяемость

- **Размеры Сетки**: Легко настраиваемые `GRID_WIDTH` и `GRID_HEIGHT` в рамках поддерживаемых соотношений сторон.
- **Цветовое Кодирование**: Расширение или модификация цветовой палитры арендаторов по мере необходимости.
- **Дополнительные Функции**: Возможность добавления интерактивных элементов или поддержки более сложных структур префиксов в будущем.

## Тестирование и Валидация

- **Интеграционные Тесты**:
  - Обеспечение корректной работы скрипта от входных CSV файлов до выходного PNG изображения.
- **Визуальная Проверка**:
  - Подтверждение правильности созданных PNG изображений, обеспечение правильного выравнивания, цветового кодирования и отсутствия визуальных артефактов.
- **Крайние Случаи**:
  - Обработка сценариев с отсутствующими полями, неверными IP адресами или неподдерживаемыми размерами сетки без сбоев.

## Лицензия

[MIT License](LICENSE)
